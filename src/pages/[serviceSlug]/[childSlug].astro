---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import ProcessSteps from '../../components/ProcessSteps.astro';
import { coreServices, findChildService, business, cities } from '../../data/architecture';
import architecture from '../../../architecture.json';

const serviceData = architecture.serviceHierarchy.serviceData;

export function getStaticPaths() {
  const paths: { params: { serviceSlug: string; childSlug: string } }[] = [];
  for (const service of coreServices) {
    for (const child of service.children) {
      paths.push({ params: { serviceSlug: service.slug, childSlug: child.slug } });
    }
  }
  return paths;
}

const { serviceSlug, childSlug } = Astro.params;
const result = findChildService(serviceSlug!, childSlug!);

if (!result) return Astro.redirect('/404');

const data = serviceData[childSlug as keyof typeof serviceData] as any;

const crumbs = [
  { label: 'Startseite', url: '/', i18nKey: 'breadcrumb.home' },
  { label: result.parent.name, url: result.parent.url },
  { label: result.name, url: result.url }
];

const schema = {
  '@context': 'https://schema.org',
  '@type': 'Service',
  serviceType: result.name,
  provider: { '@id': `https://${business.domain}/#business` },
  areaServed: cities.map(c => ({ '@type': 'City', name: c.name }))
};
---

<BaseLayout title={`${result.name} in ${business.city} — Datanalytico`} description={`${result.name} für lokale Unternehmen in der Schweiz.`} schema={schema}>
  <Breadcrumb crumbs={crumbs} />

  <section class="bg-brand-dark text-white py-16 text-center">
    <div class="container">
      <h1 class="text-white mb-4">{result.name} in {business.city}</h1>
      <p class="text-white/75 text-lg">{result.name} für lokale Unternehmen in der Schweiz.</p>
    </div>
  </section>

  <div class="py-16">
    <div class="container max-w-[900px] mx-auto">
      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Was ist {result.name}?</h2>
        <p class="leading-relaxed text-brand-text-light">{result.name} ist eine spezialisierte Dienstleistung unter <a href={`${import.meta.env.BASE_URL}${result.parent.url.slice(1)}`}>{result.parent.name}</a>. Datanalytico bietet dies für Unternehmen in Basel, Zürich und Bern an, die fokussierte Aufmerksamkeit auf diesen Teil ihrer lokalen Suchstrategie benötigen.</p>
      </section>

      <section class="mb-12 pb-12 border-b border-gray-200">
        {data?.image ? (
          <img
            src={`${import.meta.env.BASE_URL}${data.image.src.slice(1)}`}
            alt={data.image.alt}
            width="900"
            height="900"
            loading="lazy"
            decoding="async"
            class="rounded-xl mx-auto max-w-sm w-full h-auto"
          />
        ) : (
          <img
            src={`${import.meta.env.BASE_URL}brand/local-seo-agentur-google-unternehmensprofil-prozess.webp`}
            alt={`Datanalytico Google Unternehmensprofil mit 5-Sterne-Bewertung in Basel – ${result.name} für lokale Unternehmen`}
            width="900"
            height="900"
            loading="lazy"
            decoding="async"
            style="mix-blend-mode: multiply;"
            class="rounded-xl mx-auto max-w-sm w-full h-auto"
          />
        )}
      </section>

      {data?.processSteps && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Unser {result.name} Prozess</h2>
          <ProcessSteps steps={data.processSteps} />
        </section>
      )}

      {data?.priceRange && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Was kostet {result.name}?</h2>
          <p class="leading-relaxed text-brand-text-light">
            {result.name} von Datanalytico kostet zwischen {data.priceRange.min.toLocaleString('de-CH')} CHF und {data.priceRange.max.toLocaleString('de-CH')} CHF pro {data.priceRange.period === 'month' ? 'Monat' : data.priceRange.period}.
            Rufen Sie <a href={business.phoneTel} data-track-location="child_service_pricing">{business.phone}</a> an, um Ihre Bedürfnisse zu besprechen.
          </p>
        </section>
      )}

      <section class="mb-12 pb-12 border-b border-gray-200">
        <p><a href={`${import.meta.env.BASE_URL}${result.parent.url.slice(1)}`}>&larr; Zurück zu {result.parent.name}</a></p>
      </section>

      <section class="text-center p-12 bg-brand-bg rounded-xl my-12">
        <h2 class="mb-2">Starten Sie mit {result.name}</h2>
        <p class="text-brand-text-light mb-6">Kontaktieren Sie Datanalytico für eine Beratung.</p>
        <div class="flex gap-4 justify-center flex-wrap">
          <a href={business.phoneTel} class="btn btn--accent" data-track-cta="child_service_call" data-track-location="child_service_cta">Anrufen {business.phone}</a>
          <a href={`${import.meta.env.BASE_URL}contact`} class="btn btn--primary" data-track-cta="child_service_message">Nachricht senden</a>
        </div>
      </section>
    </div>
  </div>
</BaseLayout>
