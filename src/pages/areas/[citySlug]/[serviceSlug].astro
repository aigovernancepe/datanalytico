---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import ProcessSteps from '../../../components/ProcessSteps.astro';
import { cities, coreServices, findCoreService, business } from '../../../data/architecture';
import architecture from '../../../../architecture.json';

const serviceData = architecture.serviceHierarchy.serviceData;
const cityData = architecture.serviceAreaPages.cities;

export function getStaticPaths() {
  const paths: { params: { citySlug: string; serviceSlug: string } }[] = [];
  for (const city of cities) {
    for (const service of coreServices) {
      paths.push({ params: { citySlug: city.slug, serviceSlug: service.slug } });
    }
  }
  return paths;
}

const { citySlug, serviceSlug } = Astro.params;
const city = cities.find(c => c.slug === citySlug);
const service = findCoreService(serviceSlug!);

if (!city || !service) return Astro.redirect('/404');

const data = serviceData[serviceSlug as keyof typeof serviceData] as any;
const fullCity = cityData.find((c: any) => c.slug === citySlug) as any;
const nearbyCities = cities.filter(c => c.slug !== citySlug);
const otherServices = city.services.filter(s => s.slug !== serviceSlug);

const crumbs = [
  { label: 'Startseite', url: '/' },
  { label: 'Einzugsgebiete', url: '/areas' },
  { label: city.name, url: city.url },
  { label: service.name, url: `/areas/${city.slug}/${service.slug}` }
];

const faqItems = [
  {
    q: `Was kostet ${service.name.toLowerCase()} in ${city.name}?`,
    a: data?.priceRange
      ? `${service.name} in ${city.name} kostet typischerweise zwischen CHF ${data.priceRange.min.toLocaleString()} und CHF ${data.priceRange.max.toLocaleString()} pro ${data.priceRange.period === 'month' ? 'Monat' : data.priceRange.period}. Kontaktieren Sie Datanalytico unter ${business.phone} für ein Angebot, das auf Ihr Unternehmen und Ihren Markt zugeschnitten ist.`
      : `Kontaktieren Sie Datanalytico unter ${business.phone} für ${service.name.toLowerCase()} Preise in ${city.name}. Jedes Angebot basiert auf Ihrem spezifischen Markt, Wettbewerbsniveau und Ihren Zielen.`
  },
  {
    q: `Wie schnell kann Datanalytico mit einem Unternehmen in ${city.name} zusammenarbeiten?`,
    a: `Datanalytico kann eine ${service.name.toLowerCase()} Zusammenarbeit für ein Unternehmen in ${city.name} innerhalb einer Woche nach Vertragsunterzeichnung beginnen. ${fullCity?.responseTime || 'Wir treffen uns virtuell für ein schnelles Onboarding.'} Das erste Ergebnis — typischerweise ein Audit oder Strategiedokument — ist innerhalb von 7 bis 10 Werktagen fertig.`
  },
  {
    q: `Hat Datanalytico seinen Sitz in ${city.name}?`,
    a: `Datanalytico hat seinen Sitz in ${business.city} und betreut Unternehmen in ${city.name} und der grösseren Region ${city.canton}. Alle Arbeiten werden remote mit virtuellen Meetings durchgeführt, so dass Ihr Standort weder die Qualität noch die Geschwindigkeit des Services beeinflusst.`
  },
  {
    q: `Bieten Sie ${service.name.toLowerCase()} auch für andere Städte in der Nähe von ${city.name} an?`,
    a: `Ja. Datanalytico bietet ${service.name.toLowerCase()} in der ganzen Schweiz an, einschliesslich ${nearbyCities.map(c => c.name).join(' und ')}. Jede Zusammenarbeit wird auf den lokalen Markt und das Wettbewerbsniveau der Zielstadt zugeschnitten.`
  },
  {
    q: `Welche Ergebnisse kann ein Unternehmen in ${city.name} von ${service.name.toLowerCase()} erwarten?`,
    a: `Die meisten Unternehmen in ${city.name} sehen messbare Verbesserungen der lokalen Suchsichtbarkeit innerhalb von 60 bis 90 Tagen. Die Ergebnisse hängen vom Wettbewerbsniveau und der Ausgangsposition ab. Datanalytico liefert monatliche Berichte mit Ranking-Daten, Traffic-Trends und Lead-Metriken, damit Sie den Fortschritt klar verfolgen können.`
  }
];

const schema = [
  {
    '@context': 'https://schema.org',
    '@type': 'Service',
    serviceType: service.name,
    provider: { '@id': `https://${business.domain}/#business` },
    areaServed: { '@type': 'City', name: city.name }
  },
  {
    '@context': 'https://schema.org',
    '@type': 'FAQPage',
    mainEntity: faqItems.map(f => ({
      '@type': 'Question',
      name: f.q,
      acceptedAnswer: { '@type': 'Answer', text: f.a }
    }))
  }
];
---

<BaseLayout title={`${service.name} in ${city.name}, Schweiz — Datanalytico`} description={`Datanalytico liefert ${service.name.toLowerCase()} für Unternehmen in ${city.name}, ${city.canton}.`} schema={schema}>
  <Breadcrumb crumbs={crumbs} />

  <section class="bg-brand-dark text-white py-16 text-center">
    <div class="container">
      <h1 class="text-white mb-4">{service.name} in {city.name}, Schweiz</h1>
      <p class="text-white/75 text-lg">Datanalytico liefert {service.name.toLowerCase()} für Unternehmen in {city.name}, {city.canton}.</p>
    </div>
  </section>

  <div class="py-16">
    <div class="container max-w-[900px] mx-auto">
      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">{service.name} für Unternehmen in {city.name}</h2>
        <p class="leading-relaxed text-brand-text-light">{city.name} beherbergt {city.population.toLocaleString()} Einwohner und Tausende von Unternehmen, die um lokale Suchsichtbarkeit konkurrieren. {fullCity?.localContext || ''}</p>
        <p class="leading-relaxed text-brand-text-light">Datanalytico bietet {service.name.toLowerCase()} speziell zugeschnitten auf den Markt in {city.name} — unter Berücksichtigung des lokalen Wettbewerbs, des Suchverhaltens und der Branchen, die die Wirtschaft im Kanton {city.canton} antreiben.</p>
      </section>

      {data?.processSteps && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Unser {service.name} Prozess in {city.name}</h2>
          <img
            src={`${import.meta.env.BASE_URL}brand/local-seo-agentur-google-unternehmensprofil-prozess.webp`}
            alt={`Datanalytico Google Unternehmensprofil mit 5-Sterne-Bewertung – ${service.name} in ${city.name}`}
            width="900"
            height="900"
            loading="lazy"
            decoding="async"
            class="rounded-xl mx-auto max-w-sm w-full h-auto mb-8"
          />
          <ProcessSteps steps={data.processSteps} />
        </section>
      )}

      {data?.priceRange && (
        <section class="mb-12 pb-12 border-b border-gray-200 bg-brand-bg p-8 rounded-xl border-l-4 border-l-accent">
          <p class="text-[1.0625rem] mb-0">
            Die meisten {service.name.toLowerCase()} Vereinbarungen in {city.name} kosten zwischen <strong>CHF {data.priceRange.min.toLocaleString()}</strong> und <strong>CHF {data.priceRange.max.toLocaleString()}</strong> pro {data.priceRange.period === 'month' ? 'Monat' : data.priceRange.period}.
            Rufen Sie <a href={business.phoneTel}>{business.phone}</a> an für eine kostenlose Einschätzung.
          </p>
        </section>
      )}

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Warum Datanalytico für {service.name} in {city.name} wählen?</h2>
        <p class="leading-relaxed text-brand-text-light">Datanalytico ist auf den Schweizer Markt spezialisiert. Wir wissen, wie Google lokale Unternehmen in {city.name} und im gesamten Kanton {city.canton} bewertet. Jede Kampagne basiert auf echten Suchdaten — keine generischen Vorlagen. {fullCity?.responseTime ? `${fullCity.responseTime}.` : ''} Sie erhalten monatliche Berichte mit echten Ranking-Daten, damit Sie immer wissen, was funktioniert.</p>
      </section>

      {otherServices.length > 0 && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Weitere Dienstleistungen in {city.name}</h2>
          <div class="flex flex-col gap-2 mt-4">
            {otherServices.map(svc => (
              <a href={`${import.meta.env.BASE_URL}areas/${city.slug}/${svc.slug}`} class="inline-block py-2 px-4 bg-brand-bg border border-gray-200 rounded-lg font-medium text-[0.9375rem] hover:border-primary hover:bg-white no-underline transition-all">
                {svc.name} in {city.name} &rarr;
              </a>
            ))}
          </div>
        </section>
      )}

      {nearbyCities.length > 0 && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">{service.name} in umliegenden Städten</h2>
          <div class="flex flex-col gap-2 mt-4">
            {nearbyCities.map(nc => (
              <a href={`${import.meta.env.BASE_URL}areas/${nc.slug}/${serviceSlug}`} class="inline-block py-2 px-4 bg-brand-bg border border-gray-200 rounded-lg font-medium text-[0.9375rem] hover:border-primary hover:bg-white no-underline transition-all">
                {service.name} in {nc.name} &rarr;
              </a>
            ))}
          </div>
        </section>
      )}

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Häufig gestellte Fragen — {service.name} in {city.name}</h2>
        <div>
          {faqItems.map(faq => (
            <div class="mb-8">
              <h3 class="text-[1.0625rem] mb-2 text-brand-dark">{faq.q}</h3>
              <p class="text-brand-text-light leading-relaxed mb-0">{faq.a}</p>
            </div>
          ))}
        </div>
      </section>

      <section class="text-center p-12 bg-brand-bg rounded-xl my-12">
        <h2 class="mb-2">{service.name} in {city.name} erhalten</h2>
        <p class="text-brand-text-light mb-6">Kontaktieren Sie Datanalytico noch heute für eine kostenlose Überprüfung Ihrer lokalen Suchpräsenz in {city.name}.</p>
        <div class="flex gap-4 justify-center flex-wrap">
          <a href={business.phoneTel} class="btn btn--accent">Anrufen {business.phone}</a>
          <a href={`${import.meta.env.BASE_URL}contact`} class="btn btn--primary">Nachricht senden</a>
        </div>
      </section>

      <p>
        <a href={`${import.meta.env.BASE_URL}areas/${city.slug}`}>&larr; Alle Dienstleistungen in {city.name}</a>
        {' | '}
        <a href={`${import.meta.env.BASE_URL}${service.url.slice(1)}`}>{service.name} Übersicht &rarr;</a>
      </p>
    </div>
  </div>
</BaseLayout>
