---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import { cities, coreServices, findCoreService, business } from '../../../data/architecture';
import architecture from '../../../../architecture.json';

const serviceData = architecture.serviceHierarchy.serviceData;
const cityData = architecture.serviceAreaPages.cities;

export function getStaticPaths() {
  const paths: { params: { citySlug: string; serviceSlug: string } }[] = [];
  for (const city of cities) {
    for (const service of coreServices) {
      paths.push({ params: { citySlug: city.slug, serviceSlug: service.slug } });
    }
  }
  return paths;
}

const { citySlug, serviceSlug } = Astro.params;
const city = cities.find(c => c.slug === citySlug);
const service = findCoreService(serviceSlug!);

if (!city || !service) return Astro.redirect('/404');

const data = serviceData[serviceSlug as keyof typeof serviceData] as any;
const fullCity = cityData.find((c: any) => c.slug === citySlug) as any;
const nearbyCities = cities.filter(c => c.slug !== citySlug);
const otherServices = city.services.filter(s => s.slug !== serviceSlug);

const crumbs = [
  { label: 'Home', url: '/' },
  { label: 'Areas We Serve', url: '/areas' },
  { label: city.name, url: city.url },
  { label: service.name, url: `/areas/${city.slug}/${service.slug}` }
];

const faqItems = [
  {
    q: `How much does ${service.name.toLowerCase()} cost in ${city.name}?`,
    a: data?.priceRange
      ? `${service.name} in ${city.name} typically costs between CHF ${data.priceRange.min.toLocaleString()} and CHF ${data.priceRange.max.toLocaleString()} per ${data.priceRange.period}. Contact Datanalytico at ${business.phone} for a quote specific to your business and market.`
      : `Contact Datanalytico at ${business.phone} for ${service.name.toLowerCase()} pricing in ${city.name}. Every quote is based on your specific market, competition level, and goals.`
  },
  {
    q: `How quickly can Datanalytico start working with a ${city.name} business?`,
    a: `Datanalytico can begin a ${service.name.toLowerCase()} engagement for a ${city.name}-based business within one week of signing. ${fullCity?.responseTime || 'We meet virtually for fast onboarding.'} The first deliverable — typically an audit or strategy document — is ready within 7 to 10 business days.`
  },
  {
    q: `Is Datanalytico based in ${city.name}?`,
    a: `Datanalytico is based in ${business.city}, ${business.stateAbbrev}, and serves businesses across ${city.name} and the greater ${city.canton} region. All work is delivered remotely with virtual meetings, so your location does not affect the quality or speed of service.`
  },
  {
    q: `Do you offer ${service.name.toLowerCase()} for other cities near ${city.name}?`,
    a: `Yes. Datanalytico provides ${service.name.toLowerCase()} across Switzerland, including ${nearbyCities.map(c => c.name).join(' and ')}. Each engagement is tailored to the local market and competition level of the target city.`
  },
  {
    q: `What results can a ${city.name} business expect from ${service.name.toLowerCase()}?`,
    a: `Most ${city.name} businesses see measurable improvements in local search visibility within 60 to 90 days. Results depend on competition level and starting position. Datanalytico provides monthly reports with ranking data, traffic trends, and lead metrics so you can track progress clearly.`
  }
];

const schema = [
  {
    '@context': 'https://schema.org',
    '@type': 'Service',
    serviceType: service.name,
    provider: { '@id': `https://${business.domain}/#business` },
    areaServed: { '@type': 'City', name: city.name }
  },
  {
    '@context': 'https://schema.org',
    '@type': 'FAQPage',
    mainEntity: faqItems.map(f => ({
      '@type': 'Question',
      name: f.q,
      acceptedAnswer: { '@type': 'Answer', text: f.a }
    }))
  }
];
---

<BaseLayout title={`${service.name} in ${city.name}, Switzerland — Datanalytico`} description={`Datanalytico delivers ${service.name.toLowerCase()} for businesses in ${city.name}, ${city.canton}.`} schema={schema}>
  <Breadcrumb crumbs={crumbs} />

  <section class="bg-brand-dark text-white py-16 text-center">
    <div class="container">
      <h1 class="text-white mb-4">{service.name} in {city.name}, Switzerland</h1>
      <p class="text-white/75 text-lg">Datanalytico delivers {service.name.toLowerCase()} for businesses in {city.name}, {city.canton}.</p>
    </div>
  </section>

  <div class="py-16">
    <div class="container max-w-[900px] mx-auto">
      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">{service.name} for {city.name} Businesses</h2>
        <p class="leading-relaxed text-brand-text-light">{city.name} is home to {city.population.toLocaleString()} residents and thousands of businesses competing for local search visibility. {fullCity?.localContext || ''}</p>
        <p class="leading-relaxed text-brand-text-light">Datanalytico provides {service.name.toLowerCase()} specifically tailored for the {city.name} market — accounting for local competition, search behavior, and the industries that drive the {city.canton} economy.</p>
      </section>

      {data?.processSteps && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Our {service.name} Process in {city.name}</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mt-6">
            {data.processSteps.map((step: any, i: number) => (
              <div class="p-8 bg-brand-bg rounded-xl border border-gray-200">
                <div class="inline-flex items-center justify-center w-9 h-9 bg-primary text-white rounded-full font-bold text-sm mb-4">{i + 1}</div>
                <h3 class="text-[1.0625rem] mb-2">{step.title}</h3>
                <p class="text-[0.9375rem] text-brand-text-light mb-0">{step.description}</p>
              </div>
            ))}
          </div>
        </section>
      )}

      {data?.priceRange && (
        <section class="mb-12 pb-12 border-b border-gray-200 bg-brand-bg p-8 rounded-xl border-l-4 border-l-accent">
          <p class="text-[1.0625rem] mb-0">
            Most {service.name.toLowerCase()} engagements in {city.name} cost between <strong>CHF {data.priceRange.min.toLocaleString()}</strong> and <strong>CHF {data.priceRange.max.toLocaleString()}</strong> per {data.priceRange.period}.
            Call <a href={business.phoneTel}>{business.phone}</a> for a free estimate.
          </p>
        </section>
      )}

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Why Choose Datanalytico for {service.name} in {city.name}?</h2>
        <p class="leading-relaxed text-brand-text-light">Datanalytico specializes in the Swiss market. We know how Google evaluates local businesses in {city.name} and across {city.canton}. Every campaign is built on real search data — not generic templates. {fullCity?.responseTime ? `${fullCity.responseTime}.` : ''} You see monthly reports with actual ranking data, so you always know what is working.</p>
      </section>

      {otherServices.length > 0 && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Other Services in {city.name}</h2>
          <div class="flex flex-col gap-2 mt-4">
            {otherServices.map(svc => (
              <a href={`${import.meta.env.BASE_URL}areas/${city.slug}/${svc.slug}`} class="inline-block py-2 px-4 bg-brand-bg border border-gray-200 rounded-lg font-medium text-[0.9375rem] hover:border-primary hover:bg-white no-underline transition-all">
                {svc.name} in {city.name} &rarr;
              </a>
            ))}
          </div>
        </section>
      )}

      {nearbyCities.length > 0 && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">{service.name} in Nearby Cities</h2>
          <div class="flex flex-col gap-2 mt-4">
            {nearbyCities.map(nc => (
              <a href={`${import.meta.env.BASE_URL}areas/${nc.slug}/${serviceSlug}`} class="inline-block py-2 px-4 bg-brand-bg border border-gray-200 rounded-lg font-medium text-[0.9375rem] hover:border-primary hover:bg-white no-underline transition-all">
                {service.name} in {nc.name} &rarr;
              </a>
            ))}
          </div>
        </section>
      )}

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Frequently Asked Questions — {service.name} in {city.name}</h2>
        <div>
          {faqItems.map(faq => (
            <div class="mb-8">
              <h3 class="text-[1.0625rem] mb-2 text-brand-dark">{faq.q}</h3>
              <p class="text-brand-text-light leading-relaxed mb-0">{faq.a}</p>
            </div>
          ))}
        </div>
      </section>

      <section class="text-center p-12 bg-brand-bg rounded-xl my-12">
        <h2 class="mb-2">Get {service.name} in {city.name}</h2>
        <p class="text-brand-text-light mb-6">Contact Datanalytico today for a free review of your local search presence in {city.name}.</p>
        <div class="flex gap-4 justify-center flex-wrap">
          <a href={business.phoneTel} class="btn btn--accent">Call {business.phone}</a>
          <a href={`${import.meta.env.BASE_URL}contact`} class="btn btn--primary">Send a Message</a>
        </div>
      </section>

      <p>
        <a href={`${import.meta.env.BASE_URL}areas/${city.slug}`}>&larr; All services in {city.name}</a>
        {' | '}
        <a href={`${import.meta.env.BASE_URL}${service.url.slice(1)}`}>{service.name} overview &rarr;</a>
      </p>
    </div>
  </div>
</BaseLayout>
