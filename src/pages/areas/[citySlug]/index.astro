---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import { cities, business } from '../../../data/architecture';
import architecture from '../../../../architecture.json';

const cityData = architecture.serviceAreaPages.cities;

export function getStaticPaths() {
  return cities.map(c => ({ params: { citySlug: c.slug } }));
}

const { citySlug } = Astro.params;
const city = cities.find(c => c.slug === citySlug);

if (!city) return Astro.redirect('/404');

const fullCity = cityData.find((c: any) => c.slug === citySlug) as any;
const nearbyCities = cities.filter(c => c.slug !== citySlug);
const cityAdj: Record<string, string> = { basel: 'Basler', zurich: 'Zürcher', bern: 'Berner' };
const adj = cityAdj[citySlug!] || city.name;

const crumbs = [
  { label: 'Startseite', url: '/', i18nKey: 'breadcrumb.home' },
  { label: 'Einzugsgebiete', url: '/areas', i18nKey: 'breadcrumb.areas' },
  { label: city.name, url: city.url }
];

const schema = {
  '@context': 'https://schema.org',
  '@type': 'Service',
  serviceType: 'Local SEO Beratung',
  provider: { '@id': `https://${business.domain}/#business` },
  areaServed: { '@type': 'City', name: city.name, '@id': `https://en.wikipedia.org/wiki/${city.name}` }
};
---

<BaseLayout title={`Local SEO Beratung in ${city.name}, Schweiz — Datanalytico`} description={city.description} schema={schema}>
  <Breadcrumb crumbs={crumbs} />

  {citySlug === 'basel' ? (
    <section class="bg-brand-dark text-white py-16">
      <div class="container">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
          <div>
            <h1 class="text-white mb-4">Local SEO Beratung für Basel und Umgebung</h1>
            <p class="text-white/75 text-lg">{city.description}</p>
          </div>
          <div>
            <img
              src="/brand/2024-basler-herbstmesse-kasernenareal-04.webp"
              alt="Basler Herbstmesse am Kasernenareal — Local SEO Beratung für Unternehmen in Basel, Schweiz"
              class="rounded-lg w-full"
              width="640"
              height="427"
              loading="eager"
            />
          </div>
        </div>
      </div>
    </section>
  ) : (
    <section class="bg-brand-dark text-white py-16 text-center">
      <div class="container">
        <h1 class="text-white mb-4">Local SEO Beratung in {city.name}, Schweiz</h1>
        <p class="text-white/75 text-lg">{city.description}</p>
      </div>
    </section>
  )}

  <div class="py-16">
    <div class="container max-w-[900px] mx-auto">
      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Warum brauchen Unternehmen in {city.name} Local SEO?</h2>
        <p class="leading-relaxed text-brand-text-light">{fullCity?.localContext || city.description}</p>
        <p class="leading-relaxed text-brand-text-light">Datanalytico betreut Unternehmen in {city.name} von unserem Standort in {business.city} aus. {fullCity?.responseTime ? `Reaktionszeit: ${fullCity.responseTime}.` : ''} Wir arbeiten mit Unternehmen in {city.name} über alle Dienstleistungsbereiche hinweg — von professionellen Dienstleistungen bis Einzelhandel, Gesundheitswesen bis Gastronomie.</p>
      </section>

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Unsere Dienstleistungen in {city.name}</h2>
        <p class="leading-relaxed text-brand-text-light">Datanalytico bietet das gesamte Spektrum an Local SEO und Digital Marketing Dienstleistungen für Unternehmen {city.regionPhrase}.</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
          {city.services.map(svc => (
            <a href={`${import.meta.env.BASE_URL}areas/${city.slug}/${svc.slug}`} class="block p-6 bg-white border border-gray-200 rounded-lg hover:border-primary hover:shadow-sm no-underline transition-all" data-track-service={svc.name}>
              <h3 class="text-base mb-1 text-brand-dark">{svc.name}</h3>
              <span class="text-sm text-primary font-medium">{svc.name} in {city.name} &rarr;</span>
            </a>
          ))}
        </div>
      </section>

      <section class="mb-12 pb-12 border-b border-gray-200">
        <h2 class="mb-4">Über {city.name}</h2>
        <p class="leading-relaxed text-brand-text-light">{city.name} hat ungefähr {city.population.toLocaleString('de-CH')} Einwohner. {fullCity?.localContext || ''}</p>
      </section>

      {nearbyCities.length > 0 && (
        <section class="mb-12 pb-12 border-b border-gray-200">
          <h2 class="mb-4">Wir betreuen auch</h2>
          <div class="flex flex-col gap-2 mt-4">
            {nearbyCities.map(nc => (
              <a href={`${import.meta.env.BASE_URL}areas/${nc.slug}`} class="inline-block py-2 px-4 bg-brand-bg border border-gray-200 rounded-lg font-medium text-[0.9375rem] hover:border-primary hover:bg-white no-underline transition-all" data-track-area={nc.name}>
                Local SEO in {nc.name} &rarr;
              </a>
            ))}
          </div>
        </section>
      )}

      <section class="text-center p-12 bg-brand-bg rounded-xl my-12">
        <h2 class="mb-2">Ihr {adj} Unternehmen online wachsen lassen</h2>
        <p class="text-brand-text-light mb-6">Datanalytico hilft Unternehmen in {city.name}, in der lokalen Suche höher zu ranken. Kontaktieren Sie uns für eine kostenlose Analyse.</p>
        <div class="flex gap-4 justify-center flex-wrap">
          <a href={business.phoneTel} class="btn btn--accent" data-track-cta="city_page_call" data-track-location="city_page_cta">Anrufen {business.phone}</a>
          <a href={`${import.meta.env.BASE_URL}contact`} class="btn btn--primary" data-track-cta="city_page_free_analysis">Kostenlose Analyse</a>
        </div>
      </section>

      <p><a href={`${import.meta.env.BASE_URL}areas`}>&larr; Zurück zu Einzugsgebiete</a></p>
    </div>
  </div>
</BaseLayout>
